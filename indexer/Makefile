# Charms Indexer Makefile

# -----------------------------------------------
# 1. LOCAL DATABASE OPERATIONS
# -----------------------------------------------

# Start the local PostgreSQL database
.PHONY: db-start
db-start:
	@echo "ğŸ” Starting local PostgreSQL database..."
	docker-compose up -d postgres
	@echo "âœ… Database started with secure credentials from .env file"

# Stop the local PostgreSQL database
.PHONY: db-stop
db-stop:
	@echo "ğŸ›‘ Stopping local PostgreSQL database..."
	docker-compose down

# Run database migrations on local database
.PHONY: migrate
migrate: db-start
	@echo "ğŸ”„ Running database migrations on local database..."
	cargo run --bin migrate

# Reset local database (stop, remove volumes, start fresh)
.PHONY: db-reset
db-reset:
	@echo "ğŸ§¹ Resetting local database..."
	docker-compose down -v
	docker-compose up -d postgres
	@echo "âœ… Database reset. You may need to run 'make migrate' to recreate tables."


# -----------------------------------------------
# 2. RUST CODE OPERATIONS
# -----------------------------------------------

# Run the indexer
.PHONY: run
run:
	@echo "ğŸš€ Running indexer..."
	cargo run --bin charms-indexer

# Build the indexer
.PHONY: build
build:
	@echo "ğŸ”¨ Building indexer..."
	cargo build

# Clean build artifacts
.PHONY: clean
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	cargo clean

# Review code
.PHONY: check
check:
	@echo "ğŸ” Checking code..."
	cargo check
